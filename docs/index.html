<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CPB Risk Mapping — Simple Project Summary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#fff; --fg:#111; --muted:#555; --line:#e5e7eb; --accent:#2563eb;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);line-height:1.55}
    header{border-bottom:1px solid var(--line);padding:14px 18px}
    header h1{font-size:1.4rem;margin:0}
    main{max-width:920px;margin:0 auto;padding:20px 16px 60px}
    h2{margin:28px 0 8px;font-size:1.25rem}
    h3{margin:18px 0 6px;font-size:1.05rem}
    p{margin:8px 0}
    .muted{color:var(--muted)}
    .list-nav{list-style:disc;padding-left:22px;margin:6px 0 18px}
    .list-nav a{color:var(--accent);text-decoration:none}
    .list-nav a:hover{text-decoration:underline}
    figure{margin:14px 0;border:1px solid var(--line);border-radius:10px;overflow:hidden}
    figure img{display:block;width:100%;height:auto}
    figcaption{padding:8px 10px;color:var(--muted);font-size:.95rem;border-top:1px solid var(--line)}
    code{background:#f6f8fa;border:1px solid var(--line);padding:0 4px;border-radius:6px}
    pre{background:#0b1220;color:#e5e7eb;border-radius:10px;padding:12px;overflow:auto}
    ul{margin:6px 0 14px}
    .callout{border-left:4px solid #22c55e;background:#f0fdf4;padding:8px 10px;border-radius:8px;margin:10px 0}
    footer{margin-top:36px;padding-top:12px;border-top:1px solid var(--line);color:var(--muted);font-size:.95rem}
  </style>
</head>
<body>
  <header>
    <h1 style="text-align: center;">CPB Risk Mapping — Simple Project Summary</h1>
  </header>

  <main>
    <p class="muted">
      Wisconsin-wide modeling of CPB abundance using field scouting (2014–2024), climate, and crop history.
      We compare LMM, GAM, and a spatial mixed-effects model (<strong>spaMM</strong>) and produce 10×10 km risk maps.
    </p>

    <!-- Simple navigation as a list -->
    <h2>On this page</h2>
    <ul class="list-nav">
      <li><a href="#data">Data sources & engineered features</a></li>
      <li><a href="#grid">10×10 km prediction grid</a></li>
      <li><a href="#models">Modeling overview</a></li>
      <li><a href="#reduced">Model used for risk mapping</a></li>
      <li><a href="#risk">Risk map generation</a></li>
      <li><a href="#scenarios">Scenarios</a></li>
      <li><a href="#repro">Reproducibility (run order)</a></li>
      <li><a href="#links">Links to detailed HTML reports</a></li>
    </ul>

    <section id="data">
      <h2>Data sources & engineered features</h2>
      <h3>Field scouting</h3>
      <p>Annual CPB abundance per field (adults + larvae), with <em>farm</em>, <em>year</em>, and coordinates.</p>

      <h3>Crop history (CDL)</h3>
      <ul>
        <li><strong>Field-level weighted potato proportion</strong> (5-year, recency weights 5–1; range 0–1).</li>
        <li><strong>Landscape potato intensity</strong> within <strong>1.5 km</strong> (same 5-year weighting; range 0–1).</li>
      </ul>

      <h3>Climate features</h3>
      <p>
        For the <strong>modeling datasets</strong>, climate was added in Python using the
        <code>meteostat</code> API (daily series by point). We derived compact summaries such as:
        cumulative GDD, heavy summer rainfall days (&gt; 25 mm), coldest winter day, seasonal means,
        and a few variability counts.
      </p>
      <p>
        For the <strong>10×10 km risk-map predictions</strong>, we used gridded <strong>PRISM</strong> rasters
        to create the same set of covariates on the grid.
      </p>
      <div class="callout"><strong>Note:</strong> PRISM rasters are large and not stored in the repo; scripts re-create features as needed.</div>
    </section>

    <div style="background-color:#f5f5f5; padding:15px; border-radius:8px; margin-bottom:20px;">
      <h3>10×10 km prediction grid</h3>
      <p>We tile Wisconsin with an equal-area 10×10 km grid, clip to the state outline, and compute centroids (stored as lon/lat). These centroids are used to extract or aggregate covariates for prediction.</p>
      <code style="display:block; background:#333; color:#f8f8f2; padding:10px; border-radius:6px;">
        data/interim/grid10km.gpkg &nbsp;&nbsp; # grid polygons + IDs<br>
        data/interim/grid10km_centroids.csv &nbsp;&nbsp; # grid10_id, lon, lat
      </code>
    </div>

    <section id="models">
      <h2>Modeling overview</h2>
      <ol>
        <li><strong>Linear mixed-effects model (<a href="02a_model_lmer.html">LMM</a>)</strong> — fixed climate/crop effects; random intercepts for <em>Farm</em> and <em>Year</em>.</li>
        <li><strong>Generalized additive model (<a href="02b_model_gamm.html">GAM</a>)</strong> — same fixed effects plus smoothers for space (<em>lat, lon</em>) and for <em>Year</em> and <em>Farm</em>.</li>
        <li><strong>Spatial mixed-effects model (<a href="02c_model_spamm.html">spaMM</a>)</strong> — Matérn spatial random field + random intercepts for <em>Farm</em> and <em>Year</em>.</li>
      </ol>
      <p>
        Predictors most consistently associated with higher CPB abundance:
        <strong>cumulative GDD</strong>, <strong>landscape potato intensity (1.5 km)</strong>,
        warmer <strong>coldest winter day</strong>; while <strong>heavy summer rainfall days</strong> show a negative association.
      </p>
    </section>

    <section id="reduced">
      <h2>Model used for risk mapping</h2>
      <p>
        For statewide maps we use a <strong>reduced spaMM</strong> that includes only the significant predictors.
        A short comparison to the full spaMM is in
        <a href="risk_map_model.html">Risk-map Model Details</a>.
      </p>
      <div class="callout"><strong>Prediction setup:</strong> farm random effects are omitted (population mean) for out-of-sample mapping; the prediction year is fixed to 2021.</div>
    </section>

      <div style="background-color:#f5f5f5; padding:15px; border-radius:8px; margin-bottom:20px;">
        <h3>Risk map generation</h3>
        <ol>
          <li>Build standardized covariates per grid cell (PRISM + CDL features, matching model scaling).</li>
          <li>Predict abundance with the <b>reduced spaMM</b>.</li>
          <li>Rescale predictions to a 0–1 risk index (interpretability).</li>
          <li>Render a palette where <b>darker = lower risk (≈0)</b> and <b>lighter/yellow = higher risk (≈1)</b>.</li>
        </ol>
        <code style="display:block; background:#333; color:#f8f8f2; padding:10px; border-radius:6px;">
          data/processed/grid10km_risk_2021.csv &nbsp;&nbsp; # grid10_id, lon, lat, risk_index<br>
          data/processed/grid10km_risk_2021.gpkg &nbsp;&nbsp; # polygons + risk_index<br>
          figures/CPB_Risk_WI_10km_2021_baseline.png
        </code>
      </div>

      <figure>
        <img src="CPB_Risk_WI_10km_2021_baseline.png" alt="Baseline CPB 10×10 km risk surface; darker=lower, lighter/yellow=higher." />
        <figcaption><strong>Baseline risk map.</strong> Darker = lower risk; lighter/yellow = higher risk.</figcaption>
      </figure>
 

    <h3>Scenarios</h3>
      <p>We vary landscape potato intensity uniformly across the grid:</p>
      
      <div style="display:flex; gap:20px; margin-top:15px;">
        <div style="flex:1; background-color:#f5f5f5; padding:15px; border-radius:8px; text-align:center;">
          <h4>Low Intensity (x0.7)</h4>
          
          <img src="CPB_Risk_WI_10km_2021_low_intensity_0p7x.png" 
               alt="Low intensity scenario" style="width:100%; border-radius:6px;">
        </div>
        
        <div style="flex:1; background-color:#f5f5f5; padding:15px; border-radius:8px; text-align:center;">
          <h4>High Intensity (x1.5)</h4>
          
          <img src="CPB_Risk_WI_10km_2021_high_intensity_1p5x.png" 
               alt="High intensity scenario" style="width:100%; border-radius:6px;">
        </div>
      </div>

    <section id="repro">
      <h2>Reproducibility (run order)</h2>
      <ol>
        <li><strong>Grid:</strong> create 10×10 km grid & centroids.</li>
        <li><strong>Climate (model tables):</strong> add features via Python <code>meteostat</code> at field points.</li>
        <li><strong>Climate (risk map):</strong> build PRISM-based features on the grid.</li>
        <li><strong>CDL features:</strong> five-year weighted field proportion & 1.5 km intensity.</li>
        <li><strong>Final table:</strong> join features → <code>data/processed/final_data_for_modeling.csv</code>.</li>
        <li><strong>Fit models:</strong> LMM, GAM, spaMM; save objects/diagnostics.</li>
        <li><strong>Predict to grid:</strong> reduced spaMM → 0–1 risk index → CSV/GPKG/PNGs.</li>
        <li><strong>Scenarios:</strong> re-predict with intensity multipliers.</li>
      </ol>
    </section>

    <section id="links">
      <h2>Links to detailed HTML reports</h2>
      <ul>
        <li><a href="02a_model_lmer.html">Mixed Model (lmer)</a></li>
        <li><a href="02b_model_gamm.html">GAMM Model</a></li>
        <li><a href="02c_model_spamm.html">spaMM Model</a></li>
        <li><a href="risk_map_model.html">Risk-map model (reduced spaMM)</a></li>
        <li><a href="visualizations.html">EDA and Visualizations</a></li>
      </ul>
      <p class="muted">Repository: <a href="https://github.com/drnursultan/Spatiotemporal_CPB_Modeling" target="_blank" rel="noopener">GitHub</a></p>
    </section>

    <footer>
      © 2025 — CPB Risk Mapping (Wisconsin). Simple summary page.
    </footer>
  </main>
</body>
</html>